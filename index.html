<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>× ×™×”×•×œ ×¢×•×¡×§ ×¤×˜×•×¨ 2026 | ×’×™×¨×¡×” 6.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Rubik', sans-serif; background-color: #f1f5f9; }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); border: 1px solid #e2e8f0; }
        .input-group label { display: block; font-size: 0.85rem; font-weight: 600; color: #475569; margin-bottom: 2px; }
        .input-field { width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 0.9rem; outline: none; transition: border 0.2s; }
        .input-field:focus { border-color: #3b82f6; }
        .status-badge { padding: 4px 12px; border-radius: 999px; font-size: 0.75rem; font-weight: bold; }
    </style>
</head>
<body class="p-4 md:p-8 text-slate-800">

    <div class="max-w-5xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-slate-800 italic">Smart Biz Manager 2026</h1>
            <div class="flex gap-2">
                <button onclick="exportToCSV()" class="text-xs bg-white px-3 py-2 rounded-lg border hover:bg-slate-50">ğŸ“¥ ×™×™×¦×•× ×“×•×—</button>
                <button onclick="clearAllData()" class="text-xs bg-red-50 text-red-600 px-3 py-2 rounded-lg border border-red-100 hover:bg-red-100">ğŸ—‘ï¸ ××™×¤×•×¡</button>
            </div>
        </div>

        <div class="card p-6 mb-8 border-r-8 border-yellow-400">
            <div class="flex justify-between items-end mb-3">
                <h2 class="font-bold text-slate-700">××¢×§×‘ ×©× ×ª×™ ×œ×¢×•×¡×§ ×¤×˜×•×¨</h2>
                <div class="text-sm font-bold"><span id="annual-income-display">0</span> / 120,000 â‚ª</div>
            </div>
            <div class="w-full bg-slate-200 rounded-full h-3 overflow-hidden">
                <div id="ceiling-progress" class="bg-yellow-400 h-full transition-all duration-1000" style="width: 0%"></div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <div class="lg:col-span-4 space-y-6">
                <div class="card p-5">
                    <h3 class="font-bold border-b pb-2 mb-4">âš™ï¸ ×”×’×“×¨×•×ª ×•×¤×¨×•×¤×™×œ</h3>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-2">
                            <div><label class="text-[10px] uppercase font-bold text-slate-500">××™×Ÿ</label>
                            <select id="gender" class="input-field" onchange="calculate()">
                                <option value="female">××™×©×”</option><option value="male">×’×‘×¨</option>
                            </select></div>
                            <div><label class="text-[10px] uppercase font-bold text-slate-500">×™×œ×“×™×</label>
                            <input type="number" id="children" value="0" class="input-field" oninput="calculate()"></div>
                        </div>
                        <div><label class="text-[10px] uppercase font-bold text-slate-500">×‘×¨×•×˜×• ×—×•×“×©×™ ×›×©×›×™×¨/×”</label>
                        <input type="number" id="salary" placeholder="0" class="input-field bg-blue-50" oninput="calculate()"></div>
                    </div>
                </div>

                <div id="status-card" class="card p-5 bg-slate-800 text-white">
                    <h3 class="font-bold text-blue-300 mb-3 text-sm">×¡×˜×˜×•×¡ ××¡ × ×•×›×—×™:</h3>
                    <div class="space-y-3">
                        <div>
                            <div class="text-[10px] text-slate-400">××“×¨×’×ª ××¡ ×©×•×œ×™×ª</div>
                            <div id="status-tax-bracket" class="text-xl font-bold">10%</div>
                        </div>
                        <div class="pt-2 border-t border-slate-700">
                            <div id="status-next-bracket" class="text-xs text-blue-200 leading-relaxed italic">
                                ×˜×•×¢×Ÿ × ×ª×•× ×™×...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-6">
                
                <div class="card p-6 border-t-4 border-green-500">
                    <h3 class="font-bold text-green-700 mb-4 italic">×¤×™×œ×•×— ×”×›× ×¡×•×ª ×”×—×•×“×©</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="input-group"><label>×˜×™×¤×•×œ×™×</label><input type="number" data-group="inc" class="input-field border-green-200" oninput="calculate()"></div>
                        <div class="input-group"><label>×”×¨×¦××•×ª</label><input type="number" data-group="inc" class="input-field border-green-200" oninput="calculate()"></div>
                        <div class="input-group"><label>××‘×—×•× ×™×</label><input type="number" data-group="inc" class="input-field border-green-200" oninput="calculate()"></div>
                        <div class="input-group"><label>×”×“×¨×›×”</label><input type="number" data-group="inc" class="input-field border-green-200" oninput="calculate()"></div>
                        <div class="input-group"><label>×™×¢×•×¥ ××§×¦×•×¢×™</label><input type="number" data-group="inc" class="input-field border-green-200" oninput="calculate()"></div>
                        <div class="input-group"><label>××—×¨</label><input type="number" data-group="inc" class="input-field border-green-200" oninput="calculate()"></div>
                    </div>
                    <div class="mt-4 text-right font-bold text-green-800">×¡×”"×› ×”×›× ×¡×•×ª: â‚ª<span id="total-income-val">0</span></div>
                </div>

                <div class="card p-6 border-t-4 border-slate-400">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-slate-700">×”×•×¦××•×ª ×§×‘×•×¢×•×ª (× ×©××¨×•×ª)</h3>
                        <button onclick="saveFixedExpenses()" class="text-[10px] bg-slate-800 text-white px-3 py-1 rounded shadow">×©××•×¨ ×”×•×¦××•×ª ×§×‘×•×¢×•×ª</button>
                    </div>
                    <div id="fixed-exp-container" class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-3">
                        </div>
                </div>

                <div class="card p-6 border-t-4 border-red-500">
                    <h3 class="font-bold text-red-700 mb-4">×”×•×¦××•×ª ××©×ª× ×•×ª (×—×•×“×©×™×•×ª ×‘×œ×‘×“)</h3>
                    <div id="var-exp-container" class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-3">
                        </div>
                    <div id="receipt-reminder" class="hidden mt-4 p-2 bg-red-50 text-red-700 text-xs rounded border border-red-100 italic">
                        ğŸ’¡ ××œ ×ª×©×›×—×™ ×œ×©××•×¨ ×§×‘×œ×•×ª ×•×œ×ª×¢×“ ××ª ×”×”×•×¦××•×ª ×”×œ×œ×• ×‘××¢×¨×›×ª ×”× ×”×œ×ª ×”×—×©×‘×•× ×•×ª!
                    </div>
                </div>

                <div id="results-area" class="opacity-0 space-y-4 pb-10">
                    <div class="grid grid-cols-3 gap-3">
                        <div class="card p-4 bg-orange-50 border border-orange-100 text-center">
                            <div class="text-[10px] font-bold text-orange-600">××™×¡×™× ×•×‘×™×˜×•×— ×œ××•××™</div>
                            <div id="res-tax" class="text-xl font-bold">0</div>
                        </div>
                        <div class="card p-4 bg-purple-50 border border-purple-100 text-center">
                            <div class="text-[10px] font-bold text-purple-600">×¤× ×¡×™×” ×—×•×‘×”</div>
                            <div id="res-pension" class="text-xl font-bold">0</div>
                        </div>
                        <div class="card p-4 bg-blue-50 border border-blue-100 text-center">
                            <div class="text-[10px] font-bold text-blue-600">×§×¨×Ÿ ×”×©×ª×œ××•×ª</div>
                            <div id="res-study" class="text-xl font-bold">0</div>
                        </div>
                    </div>
                    <div class="card bg-slate-800 text-white p-6 shadow-2xl flex justify-between items-center">
                        <div>
                            <h4 class="text-xl font-bold text-green-400">× ×˜×• ×œ×”×¢×‘×¨×” ×”×‘×™×ª×”</h4>
                            <p class="text-[10px] text-slate-400">××—×¨×™ ×›×œ ×”×”×¤×¨×©×•×ª ×•×”××™×¡×™×</p>
                        </div>
                        <div class="text-5xl font-bold">â‚ª<span id="res-net">0</span></div>
                    </div>
                    <button onclick="saveMonthToHistory()" class="w-full bg-green-600 text-white font-bold py-3 rounded-xl hover:bg-green-700 transition">×©××•×¨ ×—×•×“×© ×–×” ×‘××¢×§×‘ ×”×©× ×ª×™ âœ…</button>
                </div>

            </div>
        </div>
    </div>

    <script>
        const C = {
            CEILING: 120000,
            AVG_WAGE: 13683,
            PENSION_R1: 0.0445, PENSION_R2: 0.1255,
            STUDY_FUND: 0.045, CREDIT_POINT: 255,
            BITUACH_LIMIT: 8210, BITUACH_R1: 0.0597, BITUACH_R2: 0.1783,
            TAX: [
                { limit: 7250, rate: 0.10 },
                { limit: 10410, rate: 0.14 },
                { limit: 16710, rate: 0.20 },
                { limit: 23230, rate: 0.31 },
                { limit: 48000, rate: 0.35 }
            ]
        };

        const FIXED_EXP_LIST = ["×¨×•××” ×—×©×‘×•×Ÿ", "××©×¨×“/×ª×•×›× ×•×ª", "×©×›×™×¨×•×ª", "×—×‘×¨×•×ª ×‘××’×•×“×”", "×‘×™×˜×•×—×™×", "× ×™×”×•×œ ×§×œ×™× ×™×§×”", "×—×©×‘×•× ×™×•×ª", "×˜×œ×¤×•×Ÿ/×ª×§×©×•×¨×ª", "×”×“×¨×›×”", "×¨×›×‘", "××—×¨"];
        const VAR_EXP_LIST = ["×”×“×¨×›×” (××©×ª× ×”)", "×›× ×¡×™×/×”×©×ª×œ××•×™×•×ª", "×—×•××¨×™× ××ª×›×œ×™×", "×¡×¤×¨×™×", "××©×—×§×™×", "×¤×¨×¡×•× ×•×©×™×•×•×§", "×›×™×‘×•×“", "×™×¢×•×¥ ×¢×¡×§×™", "×¨×›×‘ (××©×ª× ×”)", "×ª×¨×•××•×ª", "××—×¨"];

        let history = JSON.parse(localStorage.getItem('osek_history_v6')) || [];
        let savedFixed = JSON.parse(localStorage.getItem('osek_fixed_exp')) || {};

        window.onload = () => {
            initInputs();
            calculate();
        };

        function initInputs() {
            const fixedCont = document.getElementById('fixed-exp-container');
            FIXED_EXP_LIST.forEach(name => {
                const val = savedFixed[name]?.val || "";
                const freq = savedFixed[name]?.freq || "1";
                fixedCont.innerHTML += `
                    <div class="flex flex-col">
                        <label class="text-[10px] font-bold text-slate-500">${name}</label>
                        <div class="flex gap-1">
                            <input type="number" data-group="fixed" data-name="${name}" value="${val}" class="input-field text-xs" oninput="calculate()">
                            <select data-freq="${name}" class="text-[10px] border rounded" onchange="calculate()">
                                <option value="1" ${freq=="1"?'selected':''}>×—×•×“×©×™</option>
                                <option value="2" ${freq=="2"?'selected':''}>×“×•-×—×•×“×©×™</option>
                                <option value="12" ${freq=="12"?'selected':''}>×©× ×ª×™</option>
                            </select>
                        </div>
                    </div>`;
            });

            const varCont = document.getElementById('var-exp-container');
            VAR_EXP_LIST.forEach(name => {
                varCont.innerHTML += `
                    <div class="flex flex-col">
                        <label class="text-[10px] font-bold text-slate-500">${name}</label>
                        <input type="number" data-group="var" class="input-field text-xs" oninput="calculate()">
                    </div>`;
            });
        }

        function calculateTax(amount) {
            let tax = 0;
            let prevLimit = 0;
            for (let b of C.TAX) {
                if (amount > prevLimit) {
                    let taxable = Math.min(amount - prevLimit, b.limit - prevLimit);
                    tax += taxable * b.rate;
                    prevLimit = b.limit;
                }
            }
            if (amount > prevLimit) tax += (amount - prevLimit) * 0.47;
            return tax;
        }

        function calculate() {
            // Income
            let income = 0;
            document.querySelectorAll('[data-group="inc"]').forEach(i => income += parseFloat(i.value) || 0);
            document.getElementById('total-income-val').innerText = income.toLocaleString();

            // Expenses
            let fixedExpTotal = 0;
            document.querySelectorAll('[data-group="fixed"]').forEach(i => {
                const name = i.dataset.name;
                const freq = parseFloat(document.querySelector(`[data-freq="${name}"]`).value);
                fixedExpTotal += (parseFloat(i.value) || 0) / freq;
            });

            let varExpTotal = 0;
            document.querySelectorAll('[data-group="var"]').forEach(i => varExpTotal += parseFloat(i.value) || 0);
            
            document.getElementById('receipt-reminder').classList.toggle('hidden', varExpTotal === 0);

            const profit = Math.max(0, income - (fixedExpTotal + varExpTotal));
            const salary = parseFloat(document.getElementById('salary').value) || 0;
            const gender = document.getElementById('gender').value;
            const children = parseInt(document.getElementById('children').value) || 0;

            // Update Status Card
            updateStatus(salary, profit);

            if (income > 0) {
                document.getElementById('results-area').classList.replace('opacity-0', 'opacity-100');
                
                // Pension
                let pension = 0;
                const halfAvg = C.AVG_WAGE / 2;
                if (profit <= halfAvg) pension = profit * C.PENSION_R1;
                else if (profit <= C.AVG_WAGE) pension = (halfAvg * C.PENSION_R1) + ((profit - halfAvg) * C.PENSION_R2);
                else pension = (halfAvg * C.PENSION_R1) + ((C.AVG_WAGE - halfAvg) * C.PENSION_R2);

                // Bituach Leumi
                let usedLowRate = Math.min(salary, C.BITUACH_LIMIT);
                let profitAtLowRate = Math.min(profit, Math.max(0, C.BITUACH_LIMIT - usedLowRate));
                let bituach = (profitAtLowRate * C.BITUACH_R1) + (Math.max(0, profit - profitAtLowRate) * C.BITUACH_R2);

                // Tax
                let points = (gender === 'male' ? 2.25 : 2.75) + children;
                let creditValue = points * C.CREDIT_POINT;
                let businessTax = Math.max(0, (calculateTax(salary + profit) - creditValue) - Math.max(0, calculateTax(salary) - creditValue));

                const taxes = bituach + businessTax;
                const study = profit * C.STUDY_FUND;
                const net = profit - pension - study - taxes;

                document.getElementById('res-tax').innerText = Math.round(taxes).toLocaleString();
                document.getElementById('res-pension').innerText = Math.round(pension).toLocaleString();
                document.getElementById('res-study').innerText = Math.round(study).toLocaleString();
                document.getElementById('res-net').innerText = Math.round(net).toLocaleString();
            } else {
                document.getElementById('results-area').classList.replace('opacity-100', 'opacity-0');
            }
            updateAnnualDashboard();
        }

        function updateStatus(salary, currentProfit) {
            let bracket = 0.10;
            let nextLimit = C.TAX[0].limit;
            let currentTotal = salary + currentProfit;

            for (let i = 0; i < C.TAX.length; i++) {
                if (currentTotal > C.TAX[i].limit) {
                    bracket = (i + 1 < C.TAX.length) ? C.TAX[i+1].rate : 0.47;
                    nextLimit = (i + 1 < C.TAX.length) ? C.TAX[i+1].limit : 999999;
                } else {
                    bracket = C.TAX[i].rate;
                    nextLimit = C.TAX[i].limit;
                    break;
                }
            }

            document.getElementById('status-tax-bracket').innerText = (bracket * 100) + "%";
            const distance = Math.max(0, nextLimit - currentTotal);
            document.getElementById('status-next-bracket').innerHTML = 
                `××“×¨×’×ª ×”××¡ ×”×‘××” ×©×œ×š ×”×™× ${(bracket === 0.10 ? 14 : bracket === 0.14 ? 20 : 31)}%. <br> × ×©××¨ ×œ×š ×¢×•×“ <b>${Math.round(distance).toLocaleString()} â‚ª</b> ×¨×•×•×— ×”×—×•×“×© ×œ×¤× ×™ ×©×ª×¢×‘×¨×™ ××œ×™×”.`;
        }

        function saveFixedExpenses() {
            let data = {};
            document.querySelectorAll('[data-group="fixed"]').forEach(i => {
                const name = i.dataset.name;
                data[name] = { val: i.value, freq: document.querySelector(`[data-freq="${name}"]`).value };
            });
            localStorage.setItem('osek_fixed_exp', JSON.stringify(data));
            alert("×”×•×¦××•×ª ×§×‘×•×¢×•×ª × ×©××¨×•!");
        }

        function saveMonthToHistory() {
            const income = parseFloat(document.getElementById('total-income-val').innerText.replace(/,/g, ''));
            const month = new Date().toISOString().slice(0, 7);
            history = history.filter(h => h.month !== month);
            history.push({ month, income });
            localStorage.setItem('osek_history_v6', JSON.stringify(history));
            updateAnnualDashboard();
            alert("×”×—×•×“×© × ×©××¨ ×‘××¢×§×‘ ×”×©× ×ª×™!");
        }

        function updateAnnualDashboard() {
            const annualTotal = history.reduce((sum, h) => sum + h.income, 0);
            document.getElementById('annual-income-display').innerText = annualTotal.toLocaleString();
            const percent = Math.min(100, (annualTotal / C.CEILING) * 100);
            document.getElementById('ceiling-progress').style.width = percent + "%";
        }

        function clearAllData() {
            if (confirm("×œ××¤×¡ ××ª ×›×œ ×”× ×ª×•× ×™× ×•×”×”×™×¡×˜×•×¨×™×”?")) {
                localStorage.clear();
                location.reload();
            }
        }

        function exportToCSV() {
            let csv = "Month,Income\n" + history.map(h => `${h.month},${h.income}`).join("\n");
            const blob = new Blob(["\ufeff" + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "osek_report_2026.csv";
            link.click();
        }
    </script>
</body>
</html>
