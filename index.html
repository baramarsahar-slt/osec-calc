<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>× ×™×”×•×œ ×¢×•×¡×§ ×¤×˜×•×¨ 2026 | Smart Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Rubik', sans-serif; background-color: #f1f5f9; }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); border: 1px solid #e2e8f0; }
        .expense-input:focus { border-color: #ef4444; background-color: #fef2f2; }
        .progress-bar { transition: width 1s ease-in-out; }
    </style>
</head>
<body class="p-4 md:p-8 text-slate-800">

    <div class="max-w-4xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-slate-800">×”× ×™×”×•×œ ×”×¤×™× × ×¡×™ ×©×œ×™</h1>
                <p class="text-slate-500">×¢×•×¡×§ ×¤×˜×•×¨ 2026 - ×“××©×‘×•×¨×“ ×—×›×</p>
            </div>
            <div class="flex gap-2">
                <button onclick="exportToCSV()" class="bg-white text-slate-600 px-4 py-2 rounded-lg border hover:bg-slate-50 text-sm font-medium">ğŸ“¥ ×™×™×¦×•× ×œ××§×¡×œ</button>
                <button onclick="clearHistory()" class="bg-red-50 text-red-600 px-4 py-2 rounded-lg border border-red-100 hover:bg-red-100 text-sm font-medium">ğŸ—‘ï¸ ××™×¤×•×¡ ×”×›×œ</button>
            </div>
        </div>

        <div class="card p-6 mb-8 border-b-4 border-yellow-400">
            <div class="flex justify-between items-end mb-2">
                <h2 class="font-bold text-slate-700 underline decoration-yellow-400 decoration-4 underline-offset-4">××¢×§×‘ ×ª×§×¨×ª ×¢×•×¡×§ ×¤×˜×•×¨ ×©× ×ª×™</h2>
                <div class="text-sm font-bold"><span id="annual-total-display">0</span> / 120,000 â‚ª</div>
            </div>
            <div class="w-full bg-slate-200 rounded-full h-4 overflow-hidden">
                <div id="ceiling-progress" class="progress-bar bg-yellow-400 h-full" style="width: 0%"></div>
            </div>
            <p id="ceiling-alert" class="text-xs text-slate-500 mt-2 italic">××ª×—×™×œ×™× ×©× ×” ×—×“×©×”? ×”××¢×¨×›×ª ×ª×ª×¨×™×¢ ×›×©×ª×ª×§×¨×‘×™ ×œ×ª×§×¨×”.</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="space-y-6">
                <div class="card p-6">
                    <h3 class="font-bold mb-4 border-b pb-2">âš™ï¸ ×”×’×“×¨×•×ª ×§×‘×•×¢×•×ª</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-xs font-bold block mb-1">××™×Ÿ</label>
                            <select id="gender" class="w-full p-2 border rounded-md text-sm" onchange="calculateResults()">
                                <option value="female">××™×©×”</option>
                                <option value="male">×’×‘×¨</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs font-bold block mb-1">×™×œ×“×™× (&lt;18)</label>
                            <input type="number" id="children" value="0" class="w-full p-2 border rounded-md text-sm" oninput="calculateResults()">
                        </div>
                        <div>
                            <label class="text-xs font-bold block mb-1">×›×¨×™×ª ×‘×™×˜×—×•×Ÿ ×œ×—×™×¡×›×•×Ÿ (%)</label>
                            <input type="number" id="buffer-percent" value="10" class="w-full p-2 border rounded-md text-sm" oninput="calculateResults()">
                            <span class="text-[10px] text-slate-400">×¡×›×•× ×©×™×•×¤×¨×© ××”× ×˜×• ×œ×˜×•×‘×ª ×—×•×“×©×™× ×—×œ×©×™×.</span>
                        </div>
                        <div class="flex items-center gap-2 pt-2">
                            <input type="checkbox" id="isEmployee" onchange="toggleEmployeeFields()">
                            <label for="isEmployee" class="text-xs font-bold cursor-pointer">×× ×™ ×’× ×©×›×™×¨/×”</label>
                        </div>
                        <div id="employeeField" class="hidden">
                            <input type="number" id="salary" placeholder="×‘×¨×•×˜×• ×—×•×“×©×™" class="w-full p-2 border border-blue-200 rounded-md text-sm bg-blue-50" oninput="calculateResults()">
                            <div id="taxBracketInfo" class="hidden mt-2 text-[10px] text-blue-700 leading-tight">
                                ××“×¨×’×ª ××¡ ×©×•×œ×™×ª: <span id="bracketPercent" class="font-bold">10%</span>.
                            </div>
                        </div>
                    </div>
                </div>

                <div id="smart-tip" class="bg-indigo-600 text-white p-6 rounded-2xl shadow-lg hidden">
                    <div class="flex gap-2 mb-2">
                        <span class="text-xl">ğŸ’¡</span>
                        <h4 class="font-bold">×˜×™×¤ ××•×¤×˜×™××™×–×¦×™×”</h4>
                    </div>
                    <p id="tip-text" class="text-xs leading-relaxed opacity-90"></p>
                </div>
            </div>

            <div class="lg:col-span-2 space-y-6">
                <div class="card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="font-bold text-lg italic">×”×–× ×ª × ×ª×•× ×™× ×œ×—×•×“×© ×”× ×•×›×—×™</h3>
                        <input type="month" id="current-month" class="text-sm p-1 border rounded" onchange="calculateResults()">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                            <label class="text-xs font-bold text-green-700 block mb-1 uppercase">×”×›× ×¡×•×ª ×”×¢×¡×§</label>
                            <input type="number" id="income" placeholder="0" class="w-full bg-transparent text-3xl font-bold text-green-800 outline-none" oninput="calculateResults()">
                        </div>
                        <div class="bg-red-50 p-4 rounded-xl border border-red-100">
                            <label class="text-xs font-bold text-red-700 block mb-1 uppercase">×¡×”"×› ×”×•×¦××•×ª ××•×›×¨×•×ª</label>
                            <div class="text-3xl font-bold text-red-800">â‚ª<span id="totalExpensesDisplay">0</span></div>
                        </div>
                    </div>

                    <details class="group border rounded-lg overflow-hidden mb-6">
                        <summary class="flex justify-between items-center p-3 bg-slate-50 cursor-pointer hover:bg-slate-100">
                            <span class="text-sm font-bold">×¤×™×¨×•×˜ ×”×•×¦××•×ª (×œ×—×¦×™ ×œ×¤×ª×™×—×”)</span>
                            <span class="text-xs transition-transform group-open:rotate-180">â–¼</span>
                        </summary>
                        <div class="p-4 grid grid-cols-1 md:grid-cols-2 gap-4 border-t bg-white">
                            <div><label class="text-[10px] text-slate-500 uppercase">××©×¨×“/×“×™×•×¨</label><input type="number" data-group="exp" class="expense-input w-full p-2 border rounded text-sm" oninput="calculateResults()"></div>
                            <div><label class="text-[10px] text-slate-500 uppercase">×ª×©×ª×™×•×ª</label><input type="number" data-group="exp" class="expense-input w-full p-2 border rounded text-sm" oninput="calculateResults()"></div>
                            <div><label class="text-[10px] text-slate-500 uppercase">×× ×•×™×™×/AI</label><input type="number" data-group="exp" class="expense-input w-full p-2 border rounded text-sm" oninput="calculateResults()"></div>
                            <div><label class="text-[10px] text-slate-500 uppercase">×”×›×©×¨×”/×”×“×¨×›×”</label><input type="number" data-group="exp" class="expense-input w-full p-2 border rounded text-sm" oninput="calculateResults()"></div>
                            <div><label class="text-[10px] text-slate-500 uppercase">×©×™×•×•×§</label><input type="number" data-group="exp" class="expense-input w-full p-2 border rounded text-sm" oninput="calculateResults()"></div>
                            <div><label class="text-[10px] text-slate-500 uppercase">×¨×›×‘/× ×¡×™×¢×•×ª</label><input type="number" data-group="exp" class="expense-input w-full p-2 border rounded text-sm" oninput="calculateResults()"></div>
                            <div><label class="text-[10px] text-slate-500 uppercase">×¦×™×•×“/××©×—×§×™×</label><input type="number" data-group="exp" class="expense-input w-full p-2 border rounded text-sm" oninput="calculateResults()"></div>
                            <div><label class="text-[10px] text-slate-500 uppercase">×›×™×‘×•×“</label><input type="number" data-group="exp" class="expense-input w-full p-2 border rounded text-sm" oninput="calculateResults()"></div>
                        </div>
                    </details>

                    <button onclick="saveMonth()" class="w-full bg-slate-800 text-white font-bold py-3 rounded-xl hover:bg-slate-700 transition-colors shadow-lg">âœ… ×©××•×¨ ×—×•×“×© ×–×” ×‘×”×™×¡×˜×•×¨×™×”</button>
                </div>

                <div id="results" class="opacity-0 transition-opacity duration-500">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div class="bg-white p-4 rounded-xl border border-slate-200">
                            <div class="text-[10px] font-bold text-orange-600 uppercase">××™×¡×™× ×•×‘×™×˜×•×— ×œ××•××™</div>
                            <div class="text-xl font-bold">â‚ª<span id="res-tax">0</span></div>
                        </div>
                        <div class="bg-white p-4 rounded-xl border border-slate-200">
                            <div class="text-[10px] font-bold text-purple-600 uppercase">×¤× ×¡×™×” ×—×•×‘×”</div>
                            <div class="text-xl font-bold">â‚ª<span id="res-pension">0</span></div>
                        </div>
                        <div class="bg-white p-4 rounded-xl border border-slate-200">
                            <div class="text-[10px] font-bold text-blue-600 uppercase">×§×¨×Ÿ ×”×©×ª×œ××•×ª</div>
                            <div class="text-xl font-bold">â‚ª<span id="res-study">0</span></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="card p-5 border-dashed border-2 border-indigo-200 bg-indigo-50">
                            <h4 class="text-sm font-bold text-indigo-700 mb-1">×›×¨×™×ª ×‘×™×˜×—×•×Ÿ (×—×™×¡×›×•×Ÿ ×‘×¦×“)</h4>
                            <div class="text-3xl font-bold text-indigo-800">â‚ª<span id="res-buffer">0</span></div>
                            <p class="text-[10px] text-indigo-500 mt-1">×¡×›×•× ×–×” ×”×•×¤×¨×© ××”× ×˜×• ×©×œ×š ×œ×—×™×¨×•×.</p>
                        </div>
                        <div class="card bg-green-600 text-white p-5 shadow-xl">
                            <h4 class="text-sm font-bold opacity-90 mb-1">× ×˜×• ×œ×©×™××•×© ×¤×¨×˜×™ ×—×•×¤×©×™</h4>
                            <div class="text-4xl font-bold">â‚ª<span id="res-net">0</span></div>
                            <p class="text-[10px] opacity-75 mt-1">××—×¨×™ ×›×œ ×”××™×¡×™×, ×”×”×¤×¨×©×•×ª ×•×”×—×™×¡×›×•×Ÿ.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const C = {
            CEILING: 120000,
            AVG_WAGE: 13683,
            PENSION_R1: 0.0445, PENSION_R2: 0.1255,
            STUDY_FUND: 0.045, CREDIT_POINT: 255,
            BITUACH_LIMIT: 8210, BITUACH_R1: 0.0597, BITUACH_R2: 0.1783,
            TAX_B1: 7250, TAX_B2: 10410, TAX_B3: 16710, TAX_B4: 23230
        };

        let history = JSON.parse(localStorage.getItem('osek_history')) || [];

        window.onload = () => {
            const today = new Date();
            document.getElementById('current-month').value = today.toISOString().slice(0, 7);
            updateAnnualDashboard();
        };

        function toggleEmployeeFields() {
            const isEmployee = document.getElementById('isEmployee').checked;
            document.getElementById('employeeField').classList.toggle('hidden', !isEmployee);
            calculateResults();
        }

        function calculateTaxForAmount(amount) {
            let tax = 0;
            if (amount <= 0) return 0;
            let taxable = Math.min(amount, C.TAX_B1); tax += taxable * 0.10; amount -= taxable;
            if (amount > 0) { taxable = Math.min(amount, C.TAX_B2 - C.TAX_B1); tax += taxable * 0.14; amount -= taxable; }
            if (amount > 0) { taxable = Math.min(amount, C.TAX_B3 - C.TAX_B2); tax += taxable * 0.20; amount -= taxable; }
            if (amount > 0) { taxable = Math.min(amount, C.TAX_B4 - C.TAX_B3); tax += taxable * 0.31; amount -= taxable; }
            if (amount > 0) tax += amount * 0.35;
            return tax;
        }

        function calculateResults() {
            const income = parseFloat(document.getElementById('income').value) || 0;
            let expenses = 0;
            document.querySelectorAll('[data-group="exp"]').forEach(i => expenses += parseFloat(i.value) || 0);
            document.getElementById('totalExpensesDisplay').innerText = expenses.toLocaleString();

            const gender = document.getElementById('gender').value;
            const children = parseInt(document.getElementById('children').value) || 0;
            const salary = parseFloat(document.getElementById('salary').value) || 0;
            const bufferRate = (parseFloat(document.getElementById('buffer-percent').value) || 0) / 100;

            const resultsDiv = document.getElementById('results');
            if (income > 0) resultsDiv.classList.replace('opacity-0', 'opacity-100');
            else { resultsDiv.classList.replace('opacity-100', 'opacity-0'); return; }

            const profit = Math.max(0, income - expenses);

            // Pension
            let pension = 0;
            const halfAvg = C.AVG_WAGE / 2;
            if (profit <= halfAvg) pension = profit * C.PENSION_R1;
            else if (profit <= C.AVG_WAGE) pension = (halfAvg * C.PENSION_R1) + ((profit - halfAvg) * C.PENSION_R2);
            else pension = (halfAvg * C.PENSION_R1) + ((C.AVG_WAGE - halfAvg) * C.PENSION_R2);

            // Study Fund
            const studyFund = profit * C.STUDY_FUND;

            // Bituach Leumi
            let usedLowRate = Math.min(salary, C.BITUACH_LIMIT);
            let profitAtLowRate = Math.min(profit, Math.max(0, C.BITUACH_LIMIT - usedLowRate));
            let bituach = (profitAtLowRate * C.BITUACH_R1) + (Math.max(0, profit - profitAtLowRate) * C.BITUACH_R2);

            // Income Tax
            let totalIncome = salary + profit;
            let points = (gender === 'male' ? 2.25 : 2.75) + children;
            let creditValue = points * C.CREDIT_POINT;
            let finalBusinessTax = Math.max(0, (calculateTaxForAmount(totalIncome) - creditValue) - Math.max(0, calculateTaxForAmount(salary) - creditValue));

            // Marginal Tax Tip
            let marginalRate = (salary <= C.TAX_B1) ? 10 : (salary <= C.TAX_B2) ? 14 : (salary <= C.TAX_B3) ? 20 : 31;
            document.getElementById('bracketPercent').innerText = marginalRate + "%";
            
            // Smart Tips Logic
            const tipBox = document.getElementById('smart-tip');
            const tipText = document.getElementById('tip-text');
            if (marginalRate >= 20 && profit > 5000) {
                tipBox.classList.remove('hidden');
                tipText.innerText = `××ª/×” ×‘××“×¨×’×ª ××¡ ×©×œ ${marginalRate}%. ×–×” ×–××Ÿ ××¦×•×™×Ÿ ×œ×¨×›×•×© ×¦×™×•×“ ××§×¦×•×¢×™ ××• ×¡×¤×¨×•×ª ×¨×¤×•××™×ª ×©×ª×™×›× × ×ª - ×›×œ ×”×•×¦××” ×›×–×• ×ª×—×¡×•×š ×œ×š ${marginalRate}% ××¡ ×‘×¤×•×¢×œ.`;
            } else if (profit > 10000) {
                tipBox.classList.remove('hidden');
                tipText.innerText = "×”×¨×•×•×— ×”×—×•×“×©×™ ×©×œ×š ×’×‘×•×”. ×•×•×“×/×™ ×©×”×¤×§×“×ª ××ª ×”××§×¡×™××•× ×œ×§×¨×Ÿ ×”×©×ª×œ××•×ª ×›×“×™ ×œ×”× ×•×ª ××¤×˜×•×¨ ×××¡ ×¨×•×•×—×™ ×”×•×Ÿ ×‘×¢×ª×™×“.";
            } else {
                tipBox.classList.add('hidden');
            }

            const totalTaxes = bituach + finalBusinessTax;
            const potentialNet = profit - pension - studyFund - totalTaxes;
            const bufferAmount = potentialNet * bufferRate;
            const finalNet = potentialNet - bufferAmount;

            document.getElementById('res-tax').innerText = Math.round(totalTaxes).toLocaleString();
            document.getElementById('res-pension').innerText = Math.round(pension).toLocaleString();
            document.getElementById('res-study').innerText = Math.round(studyFund).toLocaleString();
            document.getElementById('res-buffer').innerText = Math.round(bufferAmount).toLocaleString();
            document.getElementById('res-net').innerText = Math.round(finalNet).toLocaleString();
        }

        function saveMonth() {
            const data = {
                month: document.getElementById('current-month').value,
                income: parseFloat(document.getElementById('income').value) || 0,
                expenses: parseFloat(document.getElementById('totalExpensesDisplay').innerText.replace(/,/g, '')) || 0,
                profit: parseFloat(document.getElementById('income').value) - parseFloat(document.getElementById('totalExpensesDisplay').innerText.replace(/,/g, ''))
            };
            
            // Overwrite if same month exists
            history = history.filter(h => h.month !== data.month);
            history.push(data);
            localStorage.setItem('osek_history', JSON.stringify(history));
            updateAnnualDashboard();
            alert("×”× ×ª×•× ×™× × ×©××¨×• ×‘×”×¦×œ×—×”!");
        }

        function updateAnnualDashboard() {
            const currentYear = new Date().getFullYear().toString();
            const yearData = history.filter(h => h.month.startsWith(currentYear));
            const annualTotal = yearData.reduce((sum, h) => sum + h.income, 0);
            
            document.getElementById('annual-total-display').innerText = annualTotal.toLocaleString();
            const percent = Math.min(100, (annualTotal / C.CEILING) * 100);
            document.getElementById('ceiling-progress').style.width = percent + "%";

            const alertText = document.getElementById('ceiling-alert');
            if (percent > 90) {
                alertText.innerText = "âš ï¸ ×©×™× ×œ×‘! ××ª/×” ×§×¨×•×‘/×” ×××•×“ ×œ×ª×§×¨×ª ×”×¢×•×¡×§ ×”×¤×˜×•×¨. ×”×ª×™×™×¢×¥/×™ ×¢× ×¨×•××” ×—×©×‘×•×Ÿ ×œ×’×‘×™ ××¢×‘×¨ ×œ×¢×•×¡×§ ××•×¨×©×”.";
                alertText.classList.replace('text-slate-500', 'text-red-600');
            } else {
                alertText.innerText = `× ×™×¦×œ×ª ${Math.round(percent)}% ××”×ª×§×¨×” ×”×©× ×ª×™×ª. × ×©××¨ ×œ×š ×¢×•×“ ${(C.CEILING - annualTotal).toLocaleString()} â‚ª ×”×©× ×”.`;
                alertText.classList.replace('text-red-600', 'text-slate-500');
            }
        }

        function exportToCSV() {
            if (history.length === 0) return alert("××™×Ÿ × ×ª×•× ×™× ×œ×©××™×¨×”");
            let csv = "×—×•×“×©,×”×›× ×¡×•×ª,×”×•×¦××•×ª,×¨×•×•×—\n";
            history.forEach(h => csv += `${h.month},${h.income},${h.expenses},${h.profit}\n`);
            const blob = new Blob(["\ufeff" + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `osek_report_${new Date().getFullYear()}.csv`;
            link.click();
        }

        function clearHistory() {
            if (confirm("×”×× ×œ××—×•×§ ××ª ×›×œ ×”×™×¡×˜×•×¨×™×™×ª ×”×”×›× ×¡×•×ª? ×¤×¢×•×œ×” ×–×• ××™× ×” ×”×¤×™×›×”.")) {
                localStorage.removeItem('osek_history');
                history = [];
                updateAnnualDashboard();
            }
        }
    </script>
</body>
</html>
